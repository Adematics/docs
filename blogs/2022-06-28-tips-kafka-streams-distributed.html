<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced tips and techniques for Kafka Streams | Kestra</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#192a4e">
    <script src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" title="Sitemap">
    <meta name="description" content="Discover some tips and nice techniques that will help you build a resilient and distributed applications">
    <meta property="article:published_time" content="2022-06-27T10:00:00.000Z">
    <meta property="article:modified_time" content="2022-06-23T20:42:55.000Z">
    <meta property="og:site_name" content="Kestra">
    <meta property="og:title" content="Advanced tips and techniques for Kafka Streams">
    <meta property="og:description" content="Discover some tips and nice techniques that will help you build a resilient and distributed applications | Kestra, infinitely scalable open source orchestration &amp; scheduling platform.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kestra.io/blogs/2022-06-28-tips-kafka-streams-distributed.html">
    <meta property="og:image" content="https://kestra.io/blogs/2022-06-28-tips-kafka-streams-distributed.jpg">
    <meta name="twitter:title" content="Advanced tips and techniques for Kafka Streams">
    <meta name="twitter:description" content="Discover some tips and nice techniques that will help you build a resilient and distributed applications | Kestra, infinitely scalable open source orchestration &amp; scheduling platform.">
    <meta name="twitter:url" content="https://kestra.io/blogs/2022-06-28-tips-kafka-streams-distributed.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://kestra.io/blogs/2022-06-28-tips-kafka-streams-distributed.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Ludovic Dehon">
    <meta name="twitter:creator" content="@tchiotludo">
    <meta name="msapplication-TileColor" content="#192a4e">
    <meta name="theme-color" content="#192a4e">
    
    <link rel="preload" href="/assets/css/0.styles.18ad4fca.css" as="style"><link rel="preload" href="/assets/js/app.78875a77.js" as="script"><link rel="preload" href="/assets/js/15.ac06b7f6.js" as="script"><link rel="preload" href="/assets/js/1.6972af6d.js" as="script"><link rel="preload" href="/assets/js/3.f0c6658b.js" as="script"><link rel="preload" href="/assets/js/33.747c116e.js" as="script"><link rel="prefetch" href="/assets/js/10.4ba4e725.js"><link rel="prefetch" href="/assets/js/100.7ff7d56b.js"><link rel="prefetch" href="/assets/js/101.f51cc0f6.js"><link rel="prefetch" href="/assets/js/102.2dcbd645.js"><link rel="prefetch" href="/assets/js/103.37c32f5c.js"><link rel="prefetch" href="/assets/js/104.2a4cb636.js"><link rel="prefetch" href="/assets/js/105.3fcfe295.js"><link rel="prefetch" href="/assets/js/106.6cdbd4c3.js"><link rel="prefetch" href="/assets/js/107.8b4073b8.js"><link rel="prefetch" href="/assets/js/108.b44a4d7c.js"><link rel="prefetch" href="/assets/js/109.38a60911.js"><link rel="prefetch" href="/assets/js/11.57dcbd04.js"><link rel="prefetch" href="/assets/js/110.1a224792.js"><link rel="prefetch" href="/assets/js/111.900ab37e.js"><link rel="prefetch" href="/assets/js/112.9a3a527b.js"><link rel="prefetch" href="/assets/js/113.7127e015.js"><link rel="prefetch" href="/assets/js/114.03047235.js"><link rel="prefetch" href="/assets/js/115.b5554e87.js"><link rel="prefetch" href="/assets/js/116.b1f943a1.js"><link rel="prefetch" href="/assets/js/117.747a2900.js"><link rel="prefetch" href="/assets/js/118.ad5707a7.js"><link rel="prefetch" href="/assets/js/119.e928fea5.js"><link rel="prefetch" href="/assets/js/12.d6f4cd34.js"><link rel="prefetch" href="/assets/js/120.3314c82b.js"><link rel="prefetch" href="/assets/js/121.d59aea68.js"><link rel="prefetch" href="/assets/js/122.d4cbb7c2.js"><link rel="prefetch" href="/assets/js/123.a923f6c4.js"><link rel="prefetch" href="/assets/js/124.3f820d74.js"><link rel="prefetch" href="/assets/js/125.7b150614.js"><link rel="prefetch" href="/assets/js/126.f8e26bd0.js"><link rel="prefetch" href="/assets/js/127.24575d1e.js"><link rel="prefetch" href="/assets/js/128.82d24286.js"><link rel="prefetch" href="/assets/js/129.6eb7aa3e.js"><link rel="prefetch" href="/assets/js/13.786a0f87.js"><link rel="prefetch" href="/assets/js/130.c7c65f79.js"><link rel="prefetch" href="/assets/js/131.1110c338.js"><link rel="prefetch" href="/assets/js/132.e799c6e2.js"><link rel="prefetch" href="/assets/js/133.a6de1ef1.js"><link rel="prefetch" href="/assets/js/134.86757090.js"><link rel="prefetch" href="/assets/js/135.d912434e.js"><link rel="prefetch" href="/assets/js/136.d0027dd3.js"><link rel="prefetch" href="/assets/js/137.3036c34e.js"><link rel="prefetch" href="/assets/js/138.402715c0.js"><link rel="prefetch" href="/assets/js/139.3cad30ff.js"><link rel="prefetch" href="/assets/js/14.866388a9.js"><link rel="prefetch" href="/assets/js/140.2b6eeed2.js"><link rel="prefetch" href="/assets/js/141.007a6283.js"><link rel="prefetch" href="/assets/js/142.60168220.js"><link rel="prefetch" href="/assets/js/143.18375833.js"><link rel="prefetch" href="/assets/js/144.0c966fe2.js"><link rel="prefetch" href="/assets/js/145.62cab681.js"><link rel="prefetch" href="/assets/js/146.0d93ba1c.js"><link rel="prefetch" href="/assets/js/147.85193bc2.js"><link rel="prefetch" href="/assets/js/148.6afc267d.js"><link rel="prefetch" href="/assets/js/149.67eb5409.js"><link rel="prefetch" href="/assets/js/150.c95e2b26.js"><link rel="prefetch" href="/assets/js/151.14f82c10.js"><link rel="prefetch" href="/assets/js/152.4d17199d.js"><link rel="prefetch" href="/assets/js/153.2c6e30f9.js"><link rel="prefetch" href="/assets/js/154.d9360127.js"><link rel="prefetch" href="/assets/js/155.5ed97f56.js"><link rel="prefetch" href="/assets/js/156.f1f2b414.js"><link rel="prefetch" href="/assets/js/157.ff632aa1.js"><link rel="prefetch" href="/assets/js/158.10f964d1.js"><link rel="prefetch" href="/assets/js/159.2429921c.js"><link rel="prefetch" href="/assets/js/16.cabd1072.js"><link rel="prefetch" href="/assets/js/160.71e1ecb5.js"><link rel="prefetch" href="/assets/js/161.97c4872e.js"><link rel="prefetch" href="/assets/js/162.763b6f0e.js"><link rel="prefetch" href="/assets/js/163.58ad8910.js"><link rel="prefetch" href="/assets/js/164.93be6479.js"><link rel="prefetch" href="/assets/js/165.63c82172.js"><link rel="prefetch" href="/assets/js/166.f74cc7cd.js"><link rel="prefetch" href="/assets/js/167.0f68efb8.js"><link rel="prefetch" href="/assets/js/168.d22976f1.js"><link rel="prefetch" href="/assets/js/169.a473ae6a.js"><link rel="prefetch" href="/assets/js/17.ea2a97b6.js"><link rel="prefetch" href="/assets/js/170.187f087f.js"><link rel="prefetch" href="/assets/js/171.97c16887.js"><link rel="prefetch" href="/assets/js/172.ec3f2574.js"><link rel="prefetch" href="/assets/js/173.e0c664d0.js"><link rel="prefetch" href="/assets/js/174.eee258ef.js"><link rel="prefetch" href="/assets/js/175.c944e513.js"><link rel="prefetch" href="/assets/js/176.39f2f2e9.js"><link rel="prefetch" href="/assets/js/177.674b626f.js"><link rel="prefetch" href="/assets/js/178.f514fad7.js"><link rel="prefetch" href="/assets/js/179.b1d954a5.js"><link rel="prefetch" href="/assets/js/18.22589e47.js"><link rel="prefetch" href="/assets/js/180.46f0f1f2.js"><link rel="prefetch" href="/assets/js/181.74dcb364.js"><link rel="prefetch" href="/assets/js/182.9d51bd65.js"><link rel="prefetch" href="/assets/js/183.97d6b225.js"><link rel="prefetch" href="/assets/js/184.7658fb31.js"><link rel="prefetch" href="/assets/js/185.f7b30058.js"><link rel="prefetch" href="/assets/js/186.f049c874.js"><link rel="prefetch" href="/assets/js/187.7173f1fe.js"><link rel="prefetch" href="/assets/js/188.fe17c199.js"><link rel="prefetch" href="/assets/js/189.861c910d.js"><link rel="prefetch" href="/assets/js/19.ecb380ef.js"><link rel="prefetch" href="/assets/js/190.e9dd0139.js"><link rel="prefetch" href="/assets/js/191.a4b3e1c2.js"><link rel="prefetch" href="/assets/js/192.d3b8c57f.js"><link rel="prefetch" href="/assets/js/193.80682750.js"><link rel="prefetch" href="/assets/js/194.24bf423f.js"><link rel="prefetch" href="/assets/js/195.82647408.js"><link rel="prefetch" href="/assets/js/196.a646be7c.js"><link rel="prefetch" href="/assets/js/197.85a9d65f.js"><link rel="prefetch" href="/assets/js/198.37156f6c.js"><link rel="prefetch" href="/assets/js/199.e7ccfb61.js"><link rel="prefetch" href="/assets/js/2.5287f224.js"><link rel="prefetch" href="/assets/js/20.27ee01ef.js"><link rel="prefetch" href="/assets/js/200.172f63e7.js"><link rel="prefetch" href="/assets/js/201.3b2bb8f4.js"><link rel="prefetch" href="/assets/js/202.3227e6ab.js"><link rel="prefetch" href="/assets/js/203.6cd575ef.js"><link rel="prefetch" href="/assets/js/204.ba219254.js"><link rel="prefetch" href="/assets/js/205.54436074.js"><link rel="prefetch" href="/assets/js/206.9df6a848.js"><link rel="prefetch" href="/assets/js/207.15d11c41.js"><link rel="prefetch" href="/assets/js/208.d42e4a3f.js"><link rel="prefetch" href="/assets/js/209.677156bd.js"><link rel="prefetch" href="/assets/js/21.78a9d417.js"><link rel="prefetch" href="/assets/js/210.fe552665.js"><link rel="prefetch" href="/assets/js/211.88d9fe85.js"><link rel="prefetch" href="/assets/js/212.14e16498.js"><link rel="prefetch" href="/assets/js/213.db72c493.js"><link rel="prefetch" href="/assets/js/214.102272af.js"><link rel="prefetch" href="/assets/js/215.0c90dd15.js"><link rel="prefetch" href="/assets/js/216.095faa91.js"><link rel="prefetch" href="/assets/js/217.61f4ee07.js"><link rel="prefetch" href="/assets/js/218.a307581e.js"><link rel="prefetch" href="/assets/js/219.6e529373.js"><link rel="prefetch" href="/assets/js/22.234bfa9e.js"><link rel="prefetch" href="/assets/js/220.632d9f9f.js"><link rel="prefetch" href="/assets/js/221.f9d31407.js"><link rel="prefetch" href="/assets/js/222.4e4b5eb5.js"><link rel="prefetch" href="/assets/js/223.81d1e06d.js"><link rel="prefetch" href="/assets/js/224.ce00f886.js"><link rel="prefetch" href="/assets/js/225.2cf8df1f.js"><link rel="prefetch" href="/assets/js/226.ff4aa16d.js"><link rel="prefetch" href="/assets/js/227.d2559a56.js"><link rel="prefetch" href="/assets/js/228.60053c7a.js"><link rel="prefetch" href="/assets/js/229.6ecb251a.js"><link rel="prefetch" href="/assets/js/23.d9b55aa0.js"><link rel="prefetch" href="/assets/js/230.41f8bd40.js"><link rel="prefetch" href="/assets/js/231.cff74442.js"><link rel="prefetch" href="/assets/js/232.0c7f93b5.js"><link rel="prefetch" href="/assets/js/233.a1304eec.js"><link rel="prefetch" href="/assets/js/234.9829e20a.js"><link rel="prefetch" href="/assets/js/235.9a6dba25.js"><link rel="prefetch" href="/assets/js/236.bb240cde.js"><link rel="prefetch" href="/assets/js/237.4cebaa09.js"><link rel="prefetch" href="/assets/js/238.0458b6d7.js"><link rel="prefetch" href="/assets/js/239.1e89380a.js"><link rel="prefetch" href="/assets/js/24.06b043f7.js"><link rel="prefetch" href="/assets/js/240.b185d3b0.js"><link rel="prefetch" href="/assets/js/241.5dd601bf.js"><link rel="prefetch" href="/assets/js/242.6121047c.js"><link rel="prefetch" href="/assets/js/243.093c9ecc.js"><link rel="prefetch" href="/assets/js/244.44a11718.js"><link rel="prefetch" href="/assets/js/245.a8db5403.js"><link rel="prefetch" href="/assets/js/246.94b5fb2c.js"><link rel="prefetch" href="/assets/js/247.69115b0d.js"><link rel="prefetch" href="/assets/js/248.341225c4.js"><link rel="prefetch" href="/assets/js/249.84680277.js"><link rel="prefetch" href="/assets/js/25.d3e4740d.js"><link rel="prefetch" href="/assets/js/250.e10f0a01.js"><link rel="prefetch" href="/assets/js/251.45322c7e.js"><link rel="prefetch" href="/assets/js/252.d7bcf40b.js"><link rel="prefetch" href="/assets/js/253.a38883dc.js"><link rel="prefetch" href="/assets/js/254.3b98872b.js"><link rel="prefetch" href="/assets/js/255.5d45099d.js"><link rel="prefetch" href="/assets/js/256.e0c02577.js"><link rel="prefetch" href="/assets/js/257.0a7b7f36.js"><link rel="prefetch" href="/assets/js/258.52a3d41e.js"><link rel="prefetch" href="/assets/js/259.286eaca5.js"><link rel="prefetch" href="/assets/js/26.3d395555.js"><link rel="prefetch" href="/assets/js/260.cb613c61.js"><link rel="prefetch" href="/assets/js/261.648b4c17.js"><link rel="prefetch" href="/assets/js/262.f54ddbc9.js"><link rel="prefetch" href="/assets/js/263.545269ad.js"><link rel="prefetch" href="/assets/js/264.c7f366f4.js"><link rel="prefetch" href="/assets/js/265.82398e9c.js"><link rel="prefetch" href="/assets/js/266.24c235d0.js"><link rel="prefetch" href="/assets/js/267.777fc654.js"><link rel="prefetch" href="/assets/js/268.82c1ac27.js"><link rel="prefetch" href="/assets/js/269.5e88af45.js"><link rel="prefetch" href="/assets/js/27.7f552f8d.js"><link rel="prefetch" href="/assets/js/270.cbe16509.js"><link rel="prefetch" href="/assets/js/271.524ca755.js"><link rel="prefetch" href="/assets/js/272.052fe7ba.js"><link rel="prefetch" href="/assets/js/273.5120b02d.js"><link rel="prefetch" href="/assets/js/274.90bc3662.js"><link rel="prefetch" href="/assets/js/275.e6f2d8f2.js"><link rel="prefetch" href="/assets/js/276.32477fa3.js"><link rel="prefetch" href="/assets/js/277.43dfd6e2.js"><link rel="prefetch" href="/assets/js/278.ae5de147.js"><link rel="prefetch" href="/assets/js/279.b412f81f.js"><link rel="prefetch" href="/assets/js/28.75cd0d6e.js"><link rel="prefetch" href="/assets/js/280.9e6d2443.js"><link rel="prefetch" href="/assets/js/281.ee84b367.js"><link rel="prefetch" href="/assets/js/282.96d91ed0.js"><link rel="prefetch" href="/assets/js/283.f81a43d0.js"><link rel="prefetch" href="/assets/js/284.2e0bfc94.js"><link rel="prefetch" href="/assets/js/285.7e543357.js"><link rel="prefetch" href="/assets/js/286.e3779747.js"><link rel="prefetch" href="/assets/js/287.2eabaade.js"><link rel="prefetch" href="/assets/js/288.421a44de.js"><link rel="prefetch" href="/assets/js/289.04d1a79e.js"><link rel="prefetch" href="/assets/js/29.ce6b8f3d.js"><link rel="prefetch" href="/assets/js/290.269d029c.js"><link rel="prefetch" href="/assets/js/291.ce2689c3.js"><link rel="prefetch" href="/assets/js/292.a68a9a33.js"><link rel="prefetch" href="/assets/js/293.33471387.js"><link rel="prefetch" href="/assets/js/294.7bd63cbf.js"><link rel="prefetch" href="/assets/js/295.6cc3bf5c.js"><link rel="prefetch" href="/assets/js/296.7eb4fcdf.js"><link rel="prefetch" href="/assets/js/297.f459be48.js"><link rel="prefetch" href="/assets/js/298.d97907b8.js"><link rel="prefetch" href="/assets/js/299.6928306d.js"><link rel="prefetch" href="/assets/js/30.49b8697c.js"><link rel="prefetch" href="/assets/js/300.37dd7ab6.js"><link rel="prefetch" href="/assets/js/301.18780a19.js"><link rel="prefetch" href="/assets/js/302.445ee688.js"><link rel="prefetch" href="/assets/js/303.dad3c6cc.js"><link rel="prefetch" href="/assets/js/304.0ee82b00.js"><link rel="prefetch" href="/assets/js/305.63a6274e.js"><link rel="prefetch" href="/assets/js/306.d0b22342.js"><link rel="prefetch" href="/assets/js/307.d6ddd71b.js"><link rel="prefetch" href="/assets/js/308.6e742120.js"><link rel="prefetch" href="/assets/js/309.0ff779a1.js"><link rel="prefetch" href="/assets/js/31.7a8ecc70.js"><link rel="prefetch" href="/assets/js/310.93ca0ee1.js"><link rel="prefetch" href="/assets/js/311.2fa17843.js"><link rel="prefetch" href="/assets/js/312.ccdefe82.js"><link rel="prefetch" href="/assets/js/313.46aba5ab.js"><link rel="prefetch" href="/assets/js/314.a664b7e8.js"><link rel="prefetch" href="/assets/js/315.42d5f2f7.js"><link rel="prefetch" href="/assets/js/316.91d9ec53.js"><link rel="prefetch" href="/assets/js/317.dddc9578.js"><link rel="prefetch" href="/assets/js/318.3db49a0e.js"><link rel="prefetch" href="/assets/js/319.a4fbbef1.js"><link rel="prefetch" href="/assets/js/32.04a355f0.js"><link rel="prefetch" href="/assets/js/320.a70a2271.js"><link rel="prefetch" href="/assets/js/321.02a3d6bf.js"><link rel="prefetch" href="/assets/js/322.18f20b94.js"><link rel="prefetch" href="/assets/js/323.34332d2d.js"><link rel="prefetch" href="/assets/js/324.8fbf3fc2.js"><link rel="prefetch" href="/assets/js/325.5ee5a07e.js"><link rel="prefetch" href="/assets/js/326.c480aa81.js"><link rel="prefetch" href="/assets/js/327.426d7b7e.js"><link rel="prefetch" href="/assets/js/328.aabfa2a0.js"><link rel="prefetch" href="/assets/js/329.c6c2ff1b.js"><link rel="prefetch" href="/assets/js/330.7d3d9931.js"><link rel="prefetch" href="/assets/js/331.fb47f5b7.js"><link rel="prefetch" href="/assets/js/332.43771e46.js"><link rel="prefetch" href="/assets/js/333.f6eaacba.js"><link rel="prefetch" href="/assets/js/334.cee04876.js"><link rel="prefetch" href="/assets/js/335.92bc86d8.js"><link rel="prefetch" href="/assets/js/336.afd5ac0b.js"><link rel="prefetch" href="/assets/js/337.b96964f7.js"><link rel="prefetch" href="/assets/js/338.b67d6457.js"><link rel="prefetch" href="/assets/js/339.8d505fe8.js"><link rel="prefetch" href="/assets/js/34.d51cf606.js"><link rel="prefetch" href="/assets/js/340.39fdb18d.js"><link rel="prefetch" href="/assets/js/341.2d36bec4.js"><link rel="prefetch" href="/assets/js/342.3216c469.js"><link rel="prefetch" href="/assets/js/343.ff3a9ffa.js"><link rel="prefetch" href="/assets/js/344.272777ec.js"><link rel="prefetch" href="/assets/js/345.59c2f27c.js"><link rel="prefetch" href="/assets/js/346.655edf4e.js"><link rel="prefetch" href="/assets/js/347.3c6b33c6.js"><link rel="prefetch" href="/assets/js/348.9167f3e2.js"><link rel="prefetch" href="/assets/js/349.37317797.js"><link rel="prefetch" href="/assets/js/35.09882549.js"><link rel="prefetch" href="/assets/js/350.50aea257.js"><link rel="prefetch" href="/assets/js/351.9610848d.js"><link rel="prefetch" href="/assets/js/352.5a7ccfbf.js"><link rel="prefetch" href="/assets/js/353.2b11ee74.js"><link rel="prefetch" href="/assets/js/354.99659e20.js"><link rel="prefetch" href="/assets/js/355.f304e896.js"><link rel="prefetch" href="/assets/js/356.e2aa4299.js"><link rel="prefetch" href="/assets/js/357.74efe31a.js"><link rel="prefetch" href="/assets/js/358.85bcf5ef.js"><link rel="prefetch" href="/assets/js/359.d5231ab7.js"><link rel="prefetch" href="/assets/js/36.0b0da42e.js"><link rel="prefetch" href="/assets/js/360.a78bfae0.js"><link rel="prefetch" href="/assets/js/361.10b72d16.js"><link rel="prefetch" href="/assets/js/362.3161bf5a.js"><link rel="prefetch" href="/assets/js/363.1412c5c0.js"><link rel="prefetch" href="/assets/js/364.2e826873.js"><link rel="prefetch" href="/assets/js/365.9697651d.js"><link rel="prefetch" href="/assets/js/366.54957cb8.js"><link rel="prefetch" href="/assets/js/367.e28617fc.js"><link rel="prefetch" href="/assets/js/368.39449028.js"><link rel="prefetch" href="/assets/js/369.72cc1b49.js"><link rel="prefetch" href="/assets/js/37.579de481.js"><link rel="prefetch" href="/assets/js/370.235fadef.js"><link rel="prefetch" href="/assets/js/371.34341ee5.js"><link rel="prefetch" href="/assets/js/372.d6b1fc7c.js"><link rel="prefetch" href="/assets/js/373.adcc3414.js"><link rel="prefetch" href="/assets/js/374.65f9bb11.js"><link rel="prefetch" href="/assets/js/375.d681e179.js"><link rel="prefetch" href="/assets/js/376.208f15db.js"><link rel="prefetch" href="/assets/js/377.c2421c0c.js"><link rel="prefetch" href="/assets/js/378.fab41bce.js"><link rel="prefetch" href="/assets/js/379.36e0e0ad.js"><link rel="prefetch" href="/assets/js/38.b1a602b7.js"><link rel="prefetch" href="/assets/js/380.c6301de6.js"><link rel="prefetch" href="/assets/js/381.f4ad3e4f.js"><link rel="prefetch" href="/assets/js/382.8dd1631c.js"><link rel="prefetch" href="/assets/js/383.7da04a32.js"><link rel="prefetch" href="/assets/js/384.a7dded0a.js"><link rel="prefetch" href="/assets/js/385.921bb9d0.js"><link rel="prefetch" href="/assets/js/386.e231d9d3.js"><link rel="prefetch" href="/assets/js/387.4fd9fa5f.js"><link rel="prefetch" href="/assets/js/388.ddc7d977.js"><link rel="prefetch" href="/assets/js/389.9ef89d67.js"><link rel="prefetch" href="/assets/js/39.59d3bae9.js"><link rel="prefetch" href="/assets/js/390.894ac8c4.js"><link rel="prefetch" href="/assets/js/391.59ddbc99.js"><link rel="prefetch" href="/assets/js/392.96b363b6.js"><link rel="prefetch" href="/assets/js/393.ca7f79a2.js"><link rel="prefetch" href="/assets/js/394.f91e0078.js"><link rel="prefetch" href="/assets/js/395.84a82005.js"><link rel="prefetch" href="/assets/js/396.703d240e.js"><link rel="prefetch" href="/assets/js/397.eee6898b.js"><link rel="prefetch" href="/assets/js/398.7eab4f39.js"><link rel="prefetch" href="/assets/js/399.7e6ba404.js"><link rel="prefetch" href="/assets/js/4.14c75dfe.js"><link rel="prefetch" href="/assets/js/40.e12f5bf5.js"><link rel="prefetch" href="/assets/js/400.652efe5c.js"><link rel="prefetch" href="/assets/js/401.0710913e.js"><link rel="prefetch" href="/assets/js/402.624e9d40.js"><link rel="prefetch" href="/assets/js/403.452ab2e5.js"><link rel="prefetch" href="/assets/js/404.39811999.js"><link rel="prefetch" href="/assets/js/405.c73e4c56.js"><link rel="prefetch" href="/assets/js/406.fa4d2212.js"><link rel="prefetch" href="/assets/js/407.5d89ce88.js"><link rel="prefetch" href="/assets/js/408.a127cf1f.js"><link rel="prefetch" href="/assets/js/409.81b36abe.js"><link rel="prefetch" href="/assets/js/41.5c602fd9.js"><link rel="prefetch" href="/assets/js/410.411d63dd.js"><link rel="prefetch" href="/assets/js/411.836f0c0c.js"><link rel="prefetch" href="/assets/js/412.a32e78c9.js"><link rel="prefetch" href="/assets/js/413.640a0a03.js"><link rel="prefetch" href="/assets/js/414.2f6516e4.js"><link rel="prefetch" href="/assets/js/415.43704563.js"><link rel="prefetch" href="/assets/js/416.4d76798b.js"><link rel="prefetch" href="/assets/js/417.5be29fad.js"><link rel="prefetch" href="/assets/js/418.70ac3bd8.js"><link rel="prefetch" href="/assets/js/419.6005086b.js"><link rel="prefetch" href="/assets/js/42.721d539a.js"><link rel="prefetch" href="/assets/js/420.8019ac47.js"><link rel="prefetch" href="/assets/js/421.dfaeb470.js"><link rel="prefetch" href="/assets/js/422.bb51e8d7.js"><link rel="prefetch" href="/assets/js/423.10960430.js"><link rel="prefetch" href="/assets/js/424.a6d224dc.js"><link rel="prefetch" href="/assets/js/425.4c1f7d1b.js"><link rel="prefetch" href="/assets/js/426.e2dc3c80.js"><link rel="prefetch" href="/assets/js/427.41f1a8bf.js"><link rel="prefetch" href="/assets/js/428.97e963ce.js"><link rel="prefetch" href="/assets/js/429.f046158f.js"><link rel="prefetch" href="/assets/js/43.ed9e83b0.js"><link rel="prefetch" href="/assets/js/430.4aa1068f.js"><link rel="prefetch" href="/assets/js/431.a821d79b.js"><link rel="prefetch" href="/assets/js/432.992de651.js"><link rel="prefetch" href="/assets/js/433.e972d780.js"><link rel="prefetch" href="/assets/js/434.d2419381.js"><link rel="prefetch" href="/assets/js/435.2a3226b8.js"><link rel="prefetch" href="/assets/js/436.8c6fb701.js"><link rel="prefetch" href="/assets/js/437.b042f342.js"><link rel="prefetch" href="/assets/js/438.7ed488ef.js"><link rel="prefetch" href="/assets/js/439.09050d58.js"><link rel="prefetch" href="/assets/js/44.8c03b5f5.js"><link rel="prefetch" href="/assets/js/440.c9782a12.js"><link rel="prefetch" href="/assets/js/441.0d5779ca.js"><link rel="prefetch" href="/assets/js/442.9754ea11.js"><link rel="prefetch" href="/assets/js/443.38e2975a.js"><link rel="prefetch" href="/assets/js/444.d22d55d3.js"><link rel="prefetch" href="/assets/js/445.3a3a1092.js"><link rel="prefetch" href="/assets/js/446.ff7b1508.js"><link rel="prefetch" href="/assets/js/447.633a53e5.js"><link rel="prefetch" href="/assets/js/448.43e1249a.js"><link rel="prefetch" href="/assets/js/449.ef2f3c74.js"><link rel="prefetch" href="/assets/js/45.9f6f2363.js"><link rel="prefetch" href="/assets/js/450.9988f508.js"><link rel="prefetch" href="/assets/js/451.e3631e8c.js"><link rel="prefetch" href="/assets/js/452.f3e3e50d.js"><link rel="prefetch" href="/assets/js/453.6f1695da.js"><link rel="prefetch" href="/assets/js/454.cff7416b.js"><link rel="prefetch" href="/assets/js/455.bd36b41c.js"><link rel="prefetch" href="/assets/js/456.85e8797a.js"><link rel="prefetch" href="/assets/js/457.9f235e18.js"><link rel="prefetch" href="/assets/js/458.bccd857a.js"><link rel="prefetch" href="/assets/js/459.3477607d.js"><link rel="prefetch" href="/assets/js/46.81d717eb.js"><link rel="prefetch" href="/assets/js/460.84d6d50a.js"><link rel="prefetch" href="/assets/js/461.9b732ec5.js"><link rel="prefetch" href="/assets/js/462.cb823c93.js"><link rel="prefetch" href="/assets/js/463.8675fb70.js"><link rel="prefetch" href="/assets/js/464.fe48ade5.js"><link rel="prefetch" href="/assets/js/465.9b5389e6.js"><link rel="prefetch" href="/assets/js/466.c63ad2c2.js"><link rel="prefetch" href="/assets/js/467.26f95f7d.js"><link rel="prefetch" href="/assets/js/468.ccd106da.js"><link rel="prefetch" href="/assets/js/469.179753c4.js"><link rel="prefetch" href="/assets/js/47.4326b879.js"><link rel="prefetch" href="/assets/js/470.8006492c.js"><link rel="prefetch" href="/assets/js/471.2748777d.js"><link rel="prefetch" href="/assets/js/472.2f756833.js"><link rel="prefetch" href="/assets/js/473.f8797667.js"><link rel="prefetch" href="/assets/js/474.a79035e5.js"><link rel="prefetch" href="/assets/js/475.7131e292.js"><link rel="prefetch" href="/assets/js/476.bd9ca760.js"><link rel="prefetch" href="/assets/js/477.5b6c8143.js"><link rel="prefetch" href="/assets/js/478.ee979bf4.js"><link rel="prefetch" href="/assets/js/479.992fd8e1.js"><link rel="prefetch" href="/assets/js/48.c1702fd5.js"><link rel="prefetch" href="/assets/js/480.78289259.js"><link rel="prefetch" href="/assets/js/481.4b5a10b4.js"><link rel="prefetch" href="/assets/js/482.9f0197ef.js"><link rel="prefetch" href="/assets/js/483.a237ccec.js"><link rel="prefetch" href="/assets/js/484.f3651e7c.js"><link rel="prefetch" href="/assets/js/485.b9a2100b.js"><link rel="prefetch" href="/assets/js/486.f0cfc8ad.js"><link rel="prefetch" href="/assets/js/487.76e84a03.js"><link rel="prefetch" href="/assets/js/488.040ef5bd.js"><link rel="prefetch" href="/assets/js/489.cd24a0ea.js"><link rel="prefetch" href="/assets/js/49.8aedc1f4.js"><link rel="prefetch" href="/assets/js/490.76a8b61d.js"><link rel="prefetch" href="/assets/js/491.5ef36f88.js"><link rel="prefetch" href="/assets/js/492.d21b98f7.js"><link rel="prefetch" href="/assets/js/493.d9e95d2f.js"><link rel="prefetch" href="/assets/js/494.826e6f78.js"><link rel="prefetch" href="/assets/js/495.2c94730a.js"><link rel="prefetch" href="/assets/js/496.8505d57f.js"><link rel="prefetch" href="/assets/js/497.54224a21.js"><link rel="prefetch" href="/assets/js/498.16f4371f.js"><link rel="prefetch" href="/assets/js/499.83f83758.js"><link rel="prefetch" href="/assets/js/50.6fa74767.js"><link rel="prefetch" href="/assets/js/500.3b9a4398.js"><link rel="prefetch" href="/assets/js/501.ecc290d5.js"><link rel="prefetch" href="/assets/js/502.984a683e.js"><link rel="prefetch" href="/assets/js/503.718113cc.js"><link rel="prefetch" href="/assets/js/504.945face4.js"><link rel="prefetch" href="/assets/js/505.a371d2a0.js"><link rel="prefetch" href="/assets/js/506.b7bc241d.js"><link rel="prefetch" href="/assets/js/507.1faa7fc0.js"><link rel="prefetch" href="/assets/js/508.31590b8e.js"><link rel="prefetch" href="/assets/js/509.add5d65e.js"><link rel="prefetch" href="/assets/js/51.f177eecc.js"><link rel="prefetch" href="/assets/js/510.43d7b8ab.js"><link rel="prefetch" href="/assets/js/511.99a1debd.js"><link rel="prefetch" href="/assets/js/512.a26984b9.js"><link rel="prefetch" href="/assets/js/513.9b9064b7.js"><link rel="prefetch" href="/assets/js/514.e6ab9365.js"><link rel="prefetch" href="/assets/js/515.d0f6db99.js"><link rel="prefetch" href="/assets/js/52.f03ce52a.js"><link rel="prefetch" href="/assets/js/53.89108fd2.js"><link rel="prefetch" href="/assets/js/54.c8252326.js"><link rel="prefetch" href="/assets/js/55.a62c5d33.js"><link rel="prefetch" href="/assets/js/56.1a1eee6a.js"><link rel="prefetch" href="/assets/js/57.a7911abb.js"><link rel="prefetch" href="/assets/js/58.3ea2add0.js"><link rel="prefetch" href="/assets/js/59.07b5c513.js"><link rel="prefetch" href="/assets/js/6.461cd48c.js"><link rel="prefetch" href="/assets/js/60.6e76469d.js"><link rel="prefetch" href="/assets/js/61.7a8d36fe.js"><link rel="prefetch" href="/assets/js/62.3ee02a89.js"><link rel="prefetch" href="/assets/js/63.cb42d754.js"><link rel="prefetch" href="/assets/js/64.5089aa50.js"><link rel="prefetch" href="/assets/js/65.34be9798.js"><link rel="prefetch" href="/assets/js/66.02b30daf.js"><link rel="prefetch" href="/assets/js/67.66ae817b.js"><link rel="prefetch" href="/assets/js/68.9e4d3c85.js"><link rel="prefetch" href="/assets/js/69.dcd79c0d.js"><link rel="prefetch" href="/assets/js/7.3bbed10e.js"><link rel="prefetch" href="/assets/js/70.7f2b127b.js"><link rel="prefetch" href="/assets/js/71.5e79a722.js"><link rel="prefetch" href="/assets/js/72.b3327521.js"><link rel="prefetch" href="/assets/js/73.4f4c76eb.js"><link rel="prefetch" href="/assets/js/74.4ae6732c.js"><link rel="prefetch" href="/assets/js/75.be3742f8.js"><link rel="prefetch" href="/assets/js/76.ac4aad39.js"><link rel="prefetch" href="/assets/js/77.4383e329.js"><link rel="prefetch" href="/assets/js/78.f080f2c7.js"><link rel="prefetch" href="/assets/js/79.2a6a55d6.js"><link rel="prefetch" href="/assets/js/8.4055ba4b.js"><link rel="prefetch" href="/assets/js/80.d8aab1af.js"><link rel="prefetch" href="/assets/js/81.f1d5dd50.js"><link rel="prefetch" href="/assets/js/82.b6c400ff.js"><link rel="prefetch" href="/assets/js/83.fb95db45.js"><link rel="prefetch" href="/assets/js/84.08cd49a9.js"><link rel="prefetch" href="/assets/js/85.f9af4191.js"><link rel="prefetch" href="/assets/js/86.571efbfa.js"><link rel="prefetch" href="/assets/js/87.e5322283.js"><link rel="prefetch" href="/assets/js/88.cdd7865c.js"><link rel="prefetch" href="/assets/js/89.03c9a1bd.js"><link rel="prefetch" href="/assets/js/9.f237df7e.js"><link rel="prefetch" href="/assets/js/90.3929e678.js"><link rel="prefetch" href="/assets/js/91.bb5023b0.js"><link rel="prefetch" href="/assets/js/92.730c8c35.js"><link rel="prefetch" href="/assets/js/93.065b3b59.js"><link rel="prefetch" href="/assets/js/94.8c8320a7.js"><link rel="prefetch" href="/assets/js/95.640d280f.js"><link rel="prefetch" href="/assets/js/96.eca91c26.js"><link rel="prefetch" href="/assets/js/97.2f3c1b3d.js"><link rel="prefetch" href="/assets/js/98.71e1206f.js"><link rel="prefetch" href="/assets/js/99.5c057c51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18ad4fca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="wrapper"><div class="widget-chat" data-v-4de6c5cf><a href="https://api.kestra.io/v1/communities/slack/redirect" target="_blank" rel="”noopener”" class="btn btn-primary rounded" data-v-4de6c5cf><span aria-hidden="true" aria-label="" role="img" class="material-design-icon slack-icon" data-v-4de6c5cf><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M6,15A2,2 0 0,1 4,17A2,2 0 0,1 2,15A2,2 0 0,1 4,13H6V15M7,15A2,2 0 0,1 9,13A2,2 0 0,1 11,15V20A2,2 0 0,1 9,22A2,2 0 0,1 7,20V15M9,7A2,2 0 0,1 7,5A2,2 0 0,1 9,3A2,2 0 0,1 11,5V7H9M9,8A2,2 0 0,1 11,10A2,2 0 0,1 9,12H4A2,2 0 0,1 2,10A2,2 0 0,1 4,8H9M17,10A2,2 0 0,1 19,8A2,2 0 0,1 21,10A2,2 0 0,1 19,12H17V10M16,10A2,2 0 0,1 14,12A2,2 0 0,1 12,10V5A2,2 0 0,1 14,3A2,2 0 0,1 16,5V10M14,18A2,2 0 0,1 16,20A2,2 0 0,1 14,22A2,2 0 0,1 12,20V18H14M14,17A2,2 0 0,1 12,15A2,2 0 0,1 14,13H19A2,2 0 0,1 21,15A2,2 0 0,1 19,17H14Z"><!----></path></svg></span> Chat <!----></a></div> <!----> <div id="container"><main class="docs"><div data-v-2496ef66><section class="bg-half text-white d-table w-100" data-v-2496ef66><div class="container" data-v-2496ef66><div class="bg-overlay bg-overlay-image" style="background-image:url(/blogs/2022-06-28-tips-kafka-streams-distributed.jpg);" data-v-2496ef66></div> <div class="bg-overlay" data-v-2496ef66></div> <div class="row justify-content-center" data-v-2496ef66><div class="col-lg-12 text-center" data-v-2496ef66><div class="page-next-level" data-v-2496ef66><h1 data-v-2496ef66> Advanced tips and techniques for Kafka Streams </h1> <div class="page-next" data-v-2496ef66><nav aria-label="breadcrumb" class="d-inline-block" data-v-2496ef66><ul class="breadcrumb bg-white rounded shadow mb-0" data-v-2496ef66><li class="breadcrumb-item" data-v-2496ef66><a href="/" class="router-link-active" data-v-2496ef66>Kestra</a></li> <li class="breadcrumb-item" data-v-2496ef66><a href="/blogs/" class="router-link-active" data-v-2496ef66>Blogs</a></li> <li aria-current="page" class="breadcrumb-item active" data-v-2496ef66>Advanced tips and techniques for Kafka Streams</li></ul></nav></div></div></div></div></div></section></div> <div class="container-fluid"><div class="row flex-xl-nowrap"><div class="col-md-3 col-xl-2"></div> <nav class="d-none d-xl-block col-xl-2 right"><ul data-v-2e06833c></ul></nav> <main role="main" class="col-md-9 col-xl-8 py-md-3 pl-md-5 docs" style="max-width: 1000px"><div class="d-flex justify-content-between mt-5 mb-3"><div class="media align-items-center"><img src="/assets/img/ldehon.ca79a90d.jpg" alt="img" class="img-fluid avatar avatar-md-sm rounded-circle shadow mr-4"> <div><h6 class="mb-0">Ludovic Dehon</h6> <span class="text-muted">
                                        Published 
                                        <time datetime="2022-06-27T10:00:00.000Z" title="2022-06-27T10:00:00.000Z" pubdate="pubdate">
    3 months ago
</time></span></div></div></div> <div class="content__default"><p>While building <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, an open-source data orchestration and scheduling platform, we decided to use Kafka as the main database to build a scalable architecture. Since Kafka allows gigabytes of throughput, we are confident to have a fully scalable solution, but we need to adapt to Kafka.</p> <p>Since we heavily rely on <a href="https://kafka.apache.org/documentation/streams/" target="_blank" rel="noopener noreferrer">Kafka Streams<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for most of our services (executor and scheduler mostly), we have made some assumptions on how it handles the workload. This blog post is here to show some advanced techniques we have to use to have a Kafka Stream reliable, we want to share with you the tips we have discovered during the last two years.</p> <h2 id="same-topic-as-source-and-destination"><a href="#same-topic-as-source-and-destination" class="header-anchor">#</a> Same topic as source and destination</h2> <p>In <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, we have a topic with the current execution that is the source and also the destination, we only update the current execution to add some information and send it back to Kafka to further processing (New tasks status for example). We are not sure that this design is possible with Kafka which lead to asking <a href="https://twitter.com/tchiotludo/status/1252197729406783488" target="_blank" rel="noopener noreferrer">Matthias J. Sax<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, one of the main maintainers of Kafka Streams, that respond to me on <a href="https://stackoverflow.com/questions/61316312/does-kafka-stream-with-same-sink-source-topics-with-join-is-supported" target="_blank" rel="noopener noreferrer">Stack Overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The short response: YES it's possible</p> <p>The long one: YES it's possible <strong>IF</strong> you are sure at 100% that for the same key (the execution in our case), you must <strong>have only one</strong> process that can write. If you see this warning in the console <code>Detected out-of-order KTable update for execution at offset 10, partition 7.</code>, you are probably in that case and this can lead to unexpected behavior (like overwrite of previous values).</p> <p>Let me explain, imagine a topology with topic as source, some branching logic, and to different process writing to the same destinations:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Execution</span><span class="token punctuation">&gt;</span></span> executions <span class="token operator">=</span> builder
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">&quot;executions&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Consumed</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Execution</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

executions
    <span class="token punctuation">.</span><span class="token function">mapValues</span><span class="token punctuation">(</span><span class="token punctuation">(</span>readOnlyKey<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">&quot;executions&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Produced</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Execution</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

executions
    <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span>
        builder<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;results&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Consumed</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">WorkerTaskResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>readOnlyKey<span class="token punctuation">,</span> value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> value1
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">&quot;executions&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Produced</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Execution</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In that case, a concurrent process can write on the same topic, overwriting the previous value and destroying the previous computed methods.<br>
For that usage, you must define a single writer for a Key at the same time. That led to our next part: a custom joiner</p> <h2 id="custom-joiner"><a href="#custom-joiner" class="header-anchor">#</a> Custom Joiner</h2> <p>In order to process execution, we have separated microservice as multiple topics, the easier topology to understand is:</p> <ul><li>a topic with the executions (with multiple tasks)</li> <li>a topic with task results.</li></ul> <p>To allow the next task to start, we need to create a state with all task results merge into the current execution. The first choice was to use a simple <code>join()</code> from Kafka Streams, what a terrible choice!</p> <p>All join provided by Kafka Streams were designed thinking with aggregation in minds (like sum, avg, ...) and works well for that case. How? It will simply process all the incoming data from both topics 1 per 1, we will see all the changes on the streams on both sides, as seen below :</p> <div class="language- extra-class"><pre class="language-text"><code># timeline
--A-------- &gt; Execution
-----B--C-- &gt; Task Result

# join result timeline
- (A,null)
- (A, B) =&gt; emit (A+B)
- (A, C) =&gt; emit (A+C) &lt;=== you have overwrite the result of A+B
- (A+B, null)
- (A+C, null) &lt;== we will never have (A+B+C)
</code></pre></div><p>In our case, we are building a state machine, and we want to keep the last state of execution, meaning we don't want to see all intermediate states (like in aggregation). In that case, we have no other choice but to build <a href="https://github.com/kestra-io/kestra/blob/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/streams/ExecutorJoinerTransformer.java" target="_blank" rel="noopener noreferrer">a custom joiner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> since Kafka Stream doesn't have any one built-in.</p> <p>To handle this case, we need to :</p> <ul><li>create a <a href="https://github.com/kestra-io/kestra/blob/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/streams/ExecutorFromExecutionTransformer.java" target="_blank" rel="noopener noreferrer">manually a store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that will save the last state of an execution</li> <li>create a custom <a href="https://github.com/kestra-io/kestra/blob/8a17519b5b41e8ba0ab8e0044c9c6b1e887ccd94/runner-kafka/src/main/java/io/kestra/runner/kafka/executors/ExecutorMain.java#L216-L246" target="_blank" rel="noopener noreferrer">merge function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that will merge the execution stream with the task results stream</li> <li><a href="https://github.com/kestra-io/kestra/blob/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/streams/ExecutorJoinerTransformer.java" target="_blank" rel="noopener noreferrer">get the last value<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from the state, add the task result and emit the new state that will be saved finally on the store and the final topics.</li></ul> <p>With all of that, we are sure that the execution state will always be the last version whatever the number of tasks results coming in parallel.</p> <h2 id="easy-distributed-workload-between-multiple-backends"><a href="#easy-distributed-workload-between-multiple-backends" class="header-anchor">#</a> Easy distributed workload between multiple backends</h2> <p>In <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, we have a scheduler that will look up all flows to schedule (timed-based) execution or with a long-pooling mechanism (detect file on file systems like S3 or SFTP). As we wanted to have no single point of failure also on this service, we need to split all the flow between all instances of schedulers.</p> <p>To handle that case, we rely on Kafka's consumer groups that will handle the whole complexity of a distributed system for us. The logic is :</p> <ul><li>Create a <a href="https://github.com/kestra-io/kestra/blob/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/KafkaFlowListeners.java" target="_blank" rel="noopener noreferrer">Kafka stream<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that will read in a <code>KTable</code> and transmit all the result to a <code>Consumer</code></li> <li>Listen to state change, meaning mostly <code>REBALANCED</code> Streams, and empty all the flows for the <code>Consumer</code></li> <li>On the <code>READY</code> state, read all the <code>KTable</code> again.</li></ul> <p>With these, all flows will be dispatched on all listeners, that's mean if you have 1,000 flows, approximately every consumer will have ~ 500 flows (depending on the repartition of keys). Kafka will handle all the heavy parts of the distributed systems :</p> <ul><li>Heartbeat to detect failure for a consumer</li> <li>Notifying of rebalancing</li> <li>Ensure exactly-once pattern for a topic, giving the assurance that only one consumer will handle the data.</li></ul> <p>This way you will have a fully distributed system thanks to Kafka without the pain to pass a Jespen analysis.</p> <h2 id="use-partitions-to-detect-dead-consumers"><a href="#use-partitions-to-detect-dead-consumers" class="header-anchor">#</a> Use partitions to detect dead consumers</h2> <p>For <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, we need to detect when a worker was processing a task and died (many cases possible through outage to simple restart during processing works).</p> <p>Thanks to Kafka consumer, we can know the partition that is affected this consumer. We use these nice features to detect dead workers. How? Here is the logic :</p> <ul><li>We create a <code>UUID</code> a startup for the worker</li> <li>When a consumer connects to Kafka, we <a href="https://github.com/kestra-io/kestra/blob/4a61af45d668feab19313b9033826fa7075bf02b/runner-kafka/src/main/java/io/kestra/runner/kafka/KafkaWorkerTaskQueue.java#L157-L187" target="_blank" rel="noopener noreferrer">listen to partitions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> affected using a <code>ConsumerRebalanceListener</code> and we publish to Kafka a WorkerInstance with <code>UUID</code> and partition assigned.</li> <li>For each task run, we publish a message with <a href="https://github.com/kestra-io/kestra/blob/4a61af45d668feab19313b9033826fa7075bf02b/runner-kafka/src/main/java/io/kestra/runner/kafka/KafkaWorkerTaskQueue.java#L112-L123" target="_blank" rel="noopener noreferrer">TaskRunning<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the Worker UUID</li></ul> <p>Now, let's handle the data stored in Kafka. The main logic is a <a href="https://github.com/kestra-io/kestra/blob/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/streams/WorkerInstanceTransformer.java" target="_blank" rel="noopener noreferrer">Kafka Stream<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that:</p> <ul><li>Create a global <code>KTable</code> with all the <code>WorkerInstance</code></li> <li>On every change, it will listen to <code>WorkerInstance</code> changed</li> <li>If there is a new <code>WorkerInstance</code>, we look at the partition assigned on this one, if there is an overlap between this instance partitions and the previous, we are sure that the previous <code>WorkerInstance</code> is dead (in Kafka, you can't have 2 consumers on the same partition).</li> <li>We only need to look at the Task affected to this <code>WorkerInstance</code> and resend them for processing.</li></ul> <p>Et voila 🎉 We have detection of dead consumers for free only with Kafka  API.</p> <h2 id="state-store-all"><a href="#state-store-all" class="header-anchor">#</a> State store <code>all()</code></h2> <p>We need to use a <a href="https://kafka.apache.org/31/documentation/streams/developer-guide/dsl-api.html#streams_concepts_globalktable" target="_blank" rel="noopener noreferrer">GlobalKTable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in order to detect <a href="/docs/developer-guide/triggers/flow.html">flow trigger</a>: for all the flow on the cluster, we test all the flows <a href="/docs/developer-guide/conditions/">conditions</a> in order to find matching flows. For this, we are using an API to fetch all flows from a <code>GlobalKTable</code> using <code>store.all()</code> that returned all the flows, fetching RockDb.</p> <p>The first assumption is that <code>all()</code> returned is an object (Flow in our case), as the API return Object, but we discovered that the <code>all()</code> will:</p> <ul><li>fetch all the data from RockDB (ok for that)</li> <li>deserialize the data from RockDB that is stored as byte and map it to concrete Java POJO</li></ul> <p>So each time we call <code>all()</code> on the method, all values are deserialized, which can lead to high CPU usage and latency on your stream. For our usage case, we are talking about all flows revision on our cluster, 2,500 flows (last revision) in our cases, but we don't see people are creating a lot of revisions (100,000), imagine 100,000 <code>byte[]</code> to deserialize to POJO for every call (mostly all the execution end).</p> <p>Since we only need the last revision in our use case, we create an in-memory Map with all the flows using:</p> <div class="language-java extra-class"><pre class="language-java"><code>builder<span class="token punctuation">.</span><span class="token function">addGlobalStore</span><span class="token punctuation">(</span>
    <span class="token class-name">Stores</span><span class="token punctuation">.</span><span class="token function">keyValueStoreBuilder</span><span class="token punctuation">(</span>
        <span class="token class-name">Stores</span><span class="token punctuation">.</span><span class="token function">persistentKeyValueStore</span><span class="token punctuation">(</span>FLOW_STATE_STORE_NAME<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Flow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    kafkaAdminService<span class="token punctuation">.</span><span class="token function">getTopicName</span><span class="token punctuation">(</span><span class="token class-name">Flow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Consumed</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonSerde</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Flow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;GlobalStore.Flow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">GlobalInMemoryStateProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
        FLOW_STATE_STORE_NAME<span class="token punctuation">,</span>
        flows <span class="token operator">-&gt;</span> kafkaFlowExecutor<span class="token punctuation">.</span><span class="token function">setFlows</span><span class="token punctuation">(</span>flows<span class="token punctuation">)</span><span class="token punctuation">,</span>
        store <span class="token operator">-&gt;</span> kafkaFlowExecutor<span class="token punctuation">.</span><span class="token function">setStore</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>with <a href="https://github.com/kestra-io/kestra/blob/master/runner-kafka/src/main/java/io/kestra/runner/kafka/streams/GlobalInMemoryStateProcessor.java" target="_blank" rel="noopener noreferrer">GlobalInMemoryStateProcessor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a simple wrapper that saves to state store and sends a full list on every change (not so frequent) and decided to gather all flow in memory. This works well on our use cases because we know that an instance of Kestra will not have millions of flows.</p> <p>But keep in mind, all store operations (also get) will lead to deserialization that costs you some CPU.</p> <h2 id="many-source-topics-within-a-stream"><a href="#many-source-topics-within-a-stream" class="header-anchor">#</a> Many source topics within a stream</h2> <p>At first, we designed <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to have only one <strong>huge</strong> stream for all the processing from the executor. At first, it seems to be cool but this lead to some drawback.</p> <p>Here is the last version of our main and only one Kafka Stream with many topics 🙉:<br> <img src="/assets/img/topology.fe80aeb6.jpg" alt="Kestra Topology"><br>
Yes, this is some kind of very large Kafka Streams. It was working almost despite the complexity of this one. But the major drawback was :</p> <ul><li><strong>Monitoring</strong>: all the metrics are under the same consumer groups</li> <li><strong>Debugging</strong>: during a crash, each topic is consumed independently, when a message failed, the whole process is crashed</li> <li>and the most important is <strong>lag</strong>: since Kafka Stream optimizes the consumption of messages by themselves, a topic with large outputs could lead to lag on other topics unrelated topics. In that case, impossible to understand properly the lag on our consumer.</li></ul> <p>Now, we have decided to split into multiple <a href="https://github.com/kestra-io/kestra/tree/develop/runner-kafka/src/main/java/io/kestra/runner/kafka/executors" target="_blank" rel="noopener noreferrer">streams<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to be able to monitors and understand properly the lag on our Kafka Streams.</p> <p>How to split your evil streams? We simply choose to consume only one time a topic (to avoid large network transit), so we grouped all streams by source topics.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>We have covered here some tips that took us a large amount of time to find the way to deal with the issue. <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">Kestra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is the only infinitely scalable data orchestration and scheduling platform, that used Kafka as backend, that allows millions of executions.</p> <p>We hope you have enjoyed this one, stay connected, and follow Kestra on <a href="https://github.com/kestra-io/kestra" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://twitter.com/kestra_io" target="_blank" rel="noopener noreferrer">Twitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, or <a href="https://api.kestra.io/v1/communities/slack/redirect" target="_blank" rel="noopener noreferrer">Slack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <div class="text-center" data-v-2b6e4a05><div class="btn-group mt-5 mb-3" data-v-2b6e4a05><a href="https://twitter.com/intent/tweet?text=Advanced%20tips%20and%20techniques%20for%20Kafka%20Streams&amp;url=https%3A%2F%2Fkestra.io%2F%2Fblogs%2F2022-06-28-tips-kafka-streams-distributed.html" target="_blank" class="btn btn-twitter" data-v-2b6e4a05><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-twitter" data-v-2b6e4a05 data-v-2b6e4a05><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-2b6e4a05 data-v-2b6e4a05></path></svg>
             Tweet
        </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fkestra.io%2F%2Fblogs%2F2022-06-28-tips-kafka-streams-distributed.html&amp;title=Advanced%20tips%20and%20techniques%20for%20Kafka%20Streams" target="_blank" class="btn btn-linkedin" data-v-2b6e4a05><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-linkedin" data-v-2b6e4a05 data-v-2b6e4a05><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" data-v-2b6e4a05 data-v-2b6e4a05></path><rect x="2" y="9" width="4" height="12" data-v-2b6e4a05 data-v-2b6e4a05></rect><circle cx="4" cy="4" r="2" data-v-2b6e4a05 data-v-2b6e4a05></circle></svg>
             Share
        </a> <a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fkestra.io%2F%2Fblogs%2F2022-06-28-tips-kafka-streams-distributed.html&amp;title=Advanced%20tips%20and%20techniques%20for%20Kafka%20Streams" target="_blank" class="btn btn-facebook" data-v-2b6e4a05><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-facebook" data-v-2b6e4a05 data-v-2b6e4a05><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" data-v-2b6e4a05 data-v-2b6e4a05></path></svg>
             Share
        </a></div> <script src="https://giscus.app/client.js" data-repo="kestra-io/kestra" data-repo-id="MDEwOlJlcG9zaXRvcnkyMDQxNjQzNTM=" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDEyMTEw" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async="async" data-v-2b6e4a05></script> <div class="mb-5" data-v-2b6e4a05></div></div></main></div></div></main></div> <div data-v-78988336><div class="position-relative shape-wrapper text-footer" data-v-22a6dc56 data-v-78988336><div class="shape overflow-hidden" data-v-22a6dc56><svg viewBox="0 0 2880 100" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-22a6dc56><path d="M 720,50 2160,0 h 720 V 100 H 0 V 50 Z" fill="currentColor" data-v-22a6dc56></path></svg></div></div> <footer class="footer" data-v-78988336><div class="container" data-v-78988336><div class="row" data-v-78988336><div class="col-lg-3 col-12 mb-0 mb-md-3 pb-0 pb-md-2" data-v-78988336><a href="/" class="logo-footer router-link-active" data-v-78988336><img src="/assets/img/logo-white.d5238fff.svg" height="60" alt="" data-v-78988336></a> <p class="mt-2" data-v-78988336>Infinitely scalable open source orchestration platform.</p> <ul class="list-unstyled social-icon social mb-0 mt-4" data-v-78988336><li class="list-inline-item" data-v-78988336><a href="https://github.com/kestra-io" target="_blank" rel="”noopener”" class="rounded" data-v-78988336><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-github" data-v-78988336 data-v-78988336><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-78988336 data-v-78988336></path></svg></a></li> <li class="list-inline-item ml-1" data-v-78988336><a href="https://twitter.com/kestra_io" target="_blank" rel="”noopener”" class="rounded" data-v-78988336><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-twitter" data-v-78988336 data-v-78988336><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-78988336 data-v-78988336></path></svg></a></li> <li class="list-inline-item ml-1" data-v-78988336><a href="https://www.linkedin.com/company/kestra" target="_blank" rel="”noopener”" class="rounded" data-v-78988336><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fea icon-sm fea-social feather feather-linkedin" data-v-78988336 data-v-78988336><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" data-v-78988336 data-v-78988336></path><rect x="2" y="9" width="4" height="12" data-v-78988336 data-v-78988336></rect><circle cx="4" cy="4" r="2" data-v-78988336 data-v-78988336></circle></svg></a></li> <li class="list-inline-item ml-1" data-v-78988336><a href="https://api.kestra.io/v1/communities/slack/redirect" target="_blank" rel="”noopener”" class="rounded" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon slack-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M6,15A2,2 0 0,1 4,17A2,2 0 0,1 2,15A2,2 0 0,1 4,13H6V15M7,15A2,2 0 0,1 9,13A2,2 0 0,1 11,15V20A2,2 0 0,1 9,22A2,2 0 0,1 7,20V15M9,7A2,2 0 0,1 7,5A2,2 0 0,1 9,3A2,2 0 0,1 11,5V7H9M9,8A2,2 0 0,1 11,10A2,2 0 0,1 9,12H4A2,2 0 0,1 2,10A2,2 0 0,1 4,8H9M17,10A2,2 0 0,1 19,8A2,2 0 0,1 21,10A2,2 0 0,1 19,12H17V10M16,10A2,2 0 0,1 14,12A2,2 0 0,1 12,10V5A2,2 0 0,1 14,3A2,2 0 0,1 16,5V10M14,18A2,2 0 0,1 16,20A2,2 0 0,1 14,22A2,2 0 0,1 12,20V18H14M14,17A2,2 0 0,1 12,15A2,2 0 0,1 14,13H19A2,2 0 0,1 21,15A2,2 0 0,1 19,17H14Z"><!----></path></svg></span></a></li></ul></div> <div class="col-lg-3 col-12 mb-0 mb-md-3 pb-0 pb-md-2" data-v-78988336><h4 class="text-light footer-head" data-v-78988336>Product</h4> <ul class="list-unstyled footer-list" data-v-78988336><li data-v-78988336><a href="/features/features.html" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> Features
                            </a></li> <li data-v-78988336><a href="/features/usages.html" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> Usage
                            </a></li> <li data-v-78988336><a href="/features/enterprise.html" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> Enterprise Edition
                            </a></li></ul></div> <div class="col-lg-3 col-12 mb-0 mb-md-3 pb-0 pb-md-2" data-v-78988336><h4 class="text-light footer-head" data-v-78988336>Learn</h4> <ul class="list-unstyled footer-list" data-v-78988336><li data-v-78988336><a href="/blogs/" class="text-foot router-link-active" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> Blogs
                            </a></li> <li data-v-78988336><a href="/docs/" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> Documentation
                            </a></li> <li data-v-78988336><a href="/plugins/" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span>  Plugins documentation
                            </a></li> <li data-v-78988336><a href="/docs/terraform/" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span>  Terraform provider
                            </a></li> <li data-v-78988336><a href="/docs/administrator-guide/" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span>  Administrator guide
                            </a></li></ul></div> <div class="col-lg-3 col-12 mb-0 mb-md-3 pb-0 pb-md-2" data-v-78988336><h4 class="text-light footer-head" data-v-78988336>Company</h4> <ul class="list-unstyled footer-list" data-v-78988336><li data-v-78988336><a href="/company/about-us.html" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span> About us
                            </a></li> <li data-v-78988336><a href="/company/contact.html" class="text-foot" data-v-78988336><span aria-hidden="true" aria-label="" role="img" class="material-design-icon chevron-right-icon" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"><!----></path></svg></span>  Contact us
                            </a></li></ul></div></div></div></footer> <footer class="footer footer-bar" data-v-78988336><div class="container text-center" data-v-78988336><div class="row align-items-center" data-v-78988336><div class="col-sm-6" data-v-78988336><div class="text-sm-left" data-v-78988336><p class="mb-0" data-v-78988336>
                          © 2022 <a href="https://kestra.io" data-v-78988336>Kestra Technologies</a>.
                          Developed with <span aria-hidden="true" role="img" class="material-design-icon heart-icon text-danger" data-v-78988336><svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"><!----></path></svg></span> in 🇫🇷 .

                        </p></div></div> <div class="col-sm-6" data-v-78988336><div class="text-sm-right" data-v-78988336><p class="mb-0" data-v-78988336><a href="/company/privacy-policy.html" data-v-78988336>Privacy Policy</a>
                            /
                            <a href="/company/cookie-policy.html" data-v-78988336>Cookie Policy</a></p></div></div></div></div></footer></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.78875a77.js" defer></script><script src="/assets/js/15.ac06b7f6.js" defer></script><script src="/assets/js/1.6972af6d.js" defer></script><script src="/assets/js/3.f0c6658b.js" defer></script><script src="/assets/js/33.747c116e.js" defer></script>
  </body>
</html>
